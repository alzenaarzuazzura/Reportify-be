generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model users {
  id         Int      @id @default(autoincrement())
  name       String   @db.VarChar(100)
  email      String   @unique @db.VarChar(100)
  password   String   @db.VarChar(255)
  role       role_enum
  created_at DateTime @default(now()) @db.DateTime(0)

  teaching_assignments teaching_assignments[]
}

enum role_enum {
  admin
  teacher
}

model levels {
  id      Int     @id @default(autoincrement())
  name    String  @db.VarChar(50)

  classes classes[]
}

model majors {
  id      Int     @id @default(autoincrement())
  name    String  @db.VarChar(50)
  code    String  @unique @db.VarChar(20)

  classes classes[]
}

model rombels {
  id      Int     @id @default(autoincrement())
  name    String  @db.VarChar(50)

  classes classes[]
}

model classes {
  id         Int @id @default(autoincrement())
  id_level   Int
  id_major   Int
  id_rombel  Int

  level  levels  @relation(fields: [id_level], references: [id], onDelete: Cascade)
  major  majors  @relation(fields: [id_major], references: [id], onDelete: Cascade)
  rombel rombels @relation(fields: [id_rombel], references: [id], onDelete: Cascade)

  students             students[]
  teaching_assignments teaching_assignments[]

  @@index([id_level])
  @@index([id_major])
  @@index([id_rombel])
}

model students {
  id                 Int      @id @default(autoincrement())
  id_class           Int
  nis                String   @unique @db.VarChar(50)
  name               String   @db.VarChar(100)
  parent_telephone   String   @db.VarChar(20)
  student_telephone  String?  @db.VarChar(20)
  created_at         DateTime @default(now()) @db.DateTime(0)

  class               classes               @relation(fields: [id_class], references: [id], onDelete: Cascade)
  attendances         attendances[]
  student_assignments student_assignments[]

  @@index([id_class])
}

model subjects {
  id   Int    @id @default(autoincrement())
  name String @db.VarChar(100)
  code String @unique @db.VarChar(20)

  teaching_assignments teaching_assignments[]
}

model teaching_assignments {
  id         Int @id @default(autoincrement())
  id_user    Int
  id_class   Int
  id_subject Int

  user    users    @relation(fields: [id_user], references: [id], onDelete: Cascade)
  class   classes  @relation(fields: [id_class], references: [id], onDelete: Cascade)
  subject subjects @relation(fields: [id_subject], references: [id], onDelete: Cascade)

  schedules     schedules[]
  attendances   attendances[]
  assignments   assignments[]
  announcements announcements[]

  @@index([id_user])
  @@index([id_class])
  @@index([id_subject])
}

model schedules {
  id                     Int       @id @default(autoincrement())
  id_teaching_assignment Int
  day                    day_enum
  start_time             String    @db.VarChar(10)
  end_time               String    @db.VarChar(10)
  room                   String    @db.VarChar(50)

  teaching_assignment teaching_assignments @relation(fields: [id_teaching_assignment], references: [id], onDelete: Cascade)
  attendances         attendances[]

  @@index([id_teaching_assignment])
}

enum day_enum {
  senin
  selasa
  rabu
  kamis
  jumat
}

model attendances {
  id                     Int       @id @default(autoincrement())
  id_student             Int
  id_teaching_assignment Int
  id_schedule            Int
  date                   DateTime  @db.Date
  checked_at             DateTime  @db.DateTime(0)
  status                 status_enum
  note                   String?   @db.VarChar(255)

  student             students             @relation(fields: [id_student], references: [id], onDelete: Cascade)
  teaching_assignment teaching_assignments @relation(fields: [id_teaching_assignment], references: [id], onDelete: Cascade)
  schedule            schedules            @relation(fields: [id_schedule], references: [id], onDelete: Cascade)

  @@index([id_student])
  @@index([id_teaching_assignment])
  @@index([id_schedule])
}

enum status_enum {
  hadir
  izin
  alfa
}

model assignments {
  id                     Int      @id @default(autoincrement())
  id_teaching_assignment Int
  assignment_title       String   @db.VarChar(200)
  assignment_desc        String   @db.Text
  deadline               DateTime @db.Date
  created_at             DateTime @default(now()) @db.DateTime(0)

  teaching_assignment teaching_assignments  @relation(fields: [id_teaching_assignment], references: [id], onDelete: Cascade)
  student_assignments student_assignments[]

  @@index([id_teaching_assignment])
}

model announcements {
  id                     Int      @id @default(autoincrement())
  id_teaching_assignment Int
  title                  String   @db.VarChar(200)
  desc                   String   @db.Text
  date                   DateTime @db.Date
  created_at             DateTime @default(now()) @db.DateTime(0)

  teaching_assignment teaching_assignments @relation(fields: [id_teaching_assignment], references: [id], onDelete: Cascade)

  @@index([id_teaching_assignment])
}

model student_assignments {
  id            Int       @id @default(autoincrement())
  id_student    Int
  id_assignment Int
  status        Boolean   @default(false)
  completed_at  DateTime? @db.DateTime(0)
  note          String?   @db.Text

  student    students    @relation(fields: [id_student], references: [id], onDelete: Cascade)
  assignment assignments @relation(fields: [id_assignment], references: [id], onDelete: Cascade)

  @@index([id_student])
  @@index([id_assignment])
}
